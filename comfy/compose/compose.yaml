name: comfy

services:
  comfy:
    image: oonray/comfy:latest
    tty: true
    entrypoint:
      - "/usr/bin/dumb-init"
      - "--"
        #- "source /home/oonray/comfy/bin/activate"
        #- "&&"
        #- "cd"
        #- "./ComfyUi"
    command:
      - "tmux"
      - "new"
        #- "python3"
        #- "main.py"
        #- "--use-sage-attention"
        #- "--listen"
        #- "0.0.0.0"
        #- "--port"
        #- "8080"
        #- "--disable-auto-launch"
        #- "--force-fp16"
        #- "--preview-method"
        #- "none"
        #- "--cache-classic"
        #- "--enable-manager"
        #- "--normalvram"
        #- "--force-non-blocking"
        #- "--disable-smart-memory"
    ports:
      - "8080:8888"
    volumes:
      #/mnt/host/e/
      - "/mnt/host/f/AI/models:/home/oonray/ComfyUI/models/checkpoints"
      - "/mnt/host/f/AI/models:/home/oonray/ComfyUI/models/diffusion_models"
      - "/mnt/host/f/AI/text:/home/oonray/ComfyUI/models/text_encoders"
      - "/mnt/host/f/AI/lora:/home/oonray/ComfyUI/models/lora"
      - "/mnt/host/f/AI/vae:/home/oonray/ComfyUI/models/vae"
      - "/mnt/host/d/out:/home/oonray/ComfyUI/output"
      - "/mnt/host/d/inp:/home/oonray/ComfyUI/input"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]


